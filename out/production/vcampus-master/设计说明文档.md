# vCampus 虚拟校园系统 - 设计说明文档

## 1. 系统概述

vCampus是一个综合性的虚拟校园管理系统，采用Java开发，基于客户端-服务器架构。系统集成了用户管理、教务管理、图书管理、商城系统和论坛功能，为学校提供一站式的数字化校园解决方案。

### 1.1 技术架构
- **开发语言**: Java
- **数据库**: MySQL 
- **GUI框架**: Java Swing + FlatLaf
- **网络通信**: Socket
- **数据传输**: 自定义协议 + Value Object (VO) 模式

### 1.2 系统特点
- 模块化设计，各功能模块相对独立
- 统一的用户认证和权限管理
- 现代化的UI界面设计
- 完整的数据完整性保障
- 良好的扩展性和维护性

## 2. 系统功能模块

### 2.1 用户管理模块
- **用户认证**: 统一的登录/注册系统
- **角色管理**: 学生、教师、管理员三种角色
- **权限控制**: 基于角色的访问控制
- **个人信息**: 用户基本信息管理

### 2.2 教务管理模块
- **课程管理**: 课程信息、时间安排、教室分配
- **选课系统**: 学生选课、退课、课程容量管理
- **成绩管理**: 多维度成绩录入、GPA计算、成绩查询
- **教师管理**: 教师信息、授课安排、成绩录入

### 2.3 图书管理模块
- **图书信息**: 图书基本信息、库存管理
- **借阅系统**: 图书借阅、归还、续借
- **逾期管理**: 逾期提醒、罚金计算

### 2.4 商城系统模块
- **商品管理**: 商品信息、库存、价格管理
- **订单系统**: 购物车、订单生成、支付流程
- **账户管理**: 用户余额、充值、消费记录

### 2.5 论坛系统模块
- **帖子管理**: 发帖、回复、编辑、删除
- **版块管理**: 分类讨论、版主管理
- **互动功能**: 点赞、评论、私信

## 3. 设计原则

### 3.1 核心设计理念
- **统一用户管理**：使用User表作为基础认证表，支持多角色管理
- **角色分离**：不同角色的业务数据分表存储，便于管理和扩展
- **数据完整性**：通过外键约束和业务逻辑保证数据一致性
- **业务导向**：围绕实际业务需求设计，提供丰富的业务功能

### 3.2 技术特点
- 使用ENUM类型增强数据约束和类型安全
- 支持级联删除和更新，保证数据一致性
- 提供完整的审计字段（创建时间、更新时间）
- 合理的索引设计提升查询性能

## 4. 数据库设计

### 4.1 核心表结构

#### 4.1.1 用户基础表 (users)
```sql
CREATE TABLE users (
    id INT PRIMARY KEY AUTO_INCREMENT,
    login_id VARCHAR(50) UNIQUE NOT NULL COMMENT '登录ID(学号/工号/管理员ID)',
    password VARCHAR(255) NOT NULL COMMENT '密码哈希',
    role ENUM('student', 'teacher', 'admin') NOT NULL COMMENT '角色',
    status ENUM('inactive', 'active', 'suspended') DEFAULT 'inactive' COMMENT '状态',
    created_time TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_time TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP
) COMMENT='用户基础表';
```

**设计要点：**
- 统一管理所有用户的认证信息
- 保持与现有系统的兼容性（使用INT类型的role和status）
- login_id对应学生学号、教师工号或管理员ID
- 包含用户的基本信息（姓名、联系方式等）

#### 4.1.2 学生信息表 (students)
```sql
CREATE TABLE students (
    student_id INT PRIMARY KEY AUTO_INCREMENT,
    user_id INT UNIQUE NOT NULL,
    student_no VARCHAR(50) UNIQUE NOT NULL COMMENT '学号',
    gender ENUM('male', 'female', 'other') COMMENT '性别',
    birth_date DATE COMMENT '出生日期',
    address TEXT COMMENT '家庭地址',
    class_name VARCHAR(100) COMMENT '所属班级',
    major VARCHAR(100) COMMENT '专业',
    grade_table_key VARCHAR(100) COMMENT '成绩数据表对应的键',
    enrollment_year INT COMMENT '入学年份',
    created_time TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_time TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
    FOREIGN KEY (user_id) REFERENCES users(user_id) ON DELETE CASCADE
) COMMENT='学生表';
```

**设计要点：**
- 通过user_id关联users表，基本信息在users表中
- 包含学生特有的详细信息
- grade_table_key字段用于关联成绩数据
- 账户余额管理在users表中统一处理

#### 4.1.3 教师信息表 (teachers)
```sql
CREATE TABLE teachers (
    teacher_id INT PRIMARY KEY AUTO_INCREMENT,
    user_id INT UNIQUE NOT NULL,
    teacher_no VARCHAR(50) UNIQUE NOT NULL COMMENT '工号',
    title VARCHAR(50) COMMENT '职称',
    office VARCHAR(100) COMMENT '办公室',
    research_area TEXT COMMENT '研究方向',
    created_time TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_time TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
    FOREIGN KEY (user_id) REFERENCES users(user_id) ON DELETE CASCADE
) COMMENT='教师表';
```

**设计要点：**
- 存储教师特有的专业信息
- 基本信息（姓名、联系方式等）在users表中统一管理
- 支持职称、办公室、研究方向等扩展信息
- 为教师课程管理提供基础数据

#### 4.1.4 课程表 (courses)
```sql
CREATE TABLE courses (
    id INT PRIMARY KEY AUTO_INCREMENT,
    course_code VARCHAR(50) UNIQUE NOT NULL COMMENT '课程代码',
    course_name VARCHAR(200) NOT NULL COMMENT '课程名称',
    credits INT NOT NULL DEFAULT 1 COMMENT '学分',
    department VARCHAR(100) COMMENT '开课院系',
    teacher_id INT COMMENT '任课教师ID',
    semester VARCHAR(50) COMMENT '开课学期',
    academic_year VARCHAR(20) COMMENT '学年',
    class_time VARCHAR(200) COMMENT '上课时间描述',
    location VARCHAR(200) COMMENT '上课地点',
    capacity INT DEFAULT 50 COMMENT '课程容量',
    enrolled_count INT DEFAULT 0 COMMENT '已选人数',
    status ENUM('planning', 'active', 'inactive', 'completed') DEFAULT 'planning',
    description TEXT COMMENT '课程描述',
    prerequisites TEXT COMMENT '先修课程要求',
    syllabus TEXT COMMENT '教学大纲',
    FOREIGN KEY (teacher_id) REFERENCES teachers(id) ON DELETE SET NULL
) COMMENT='课程表';
```

**设计要点：**
- 支持课程的完整生命周期管理
- 包含先修课程和教学大纲信息
- 通过teacher_id关联到具体教师
- 使用ENUM管理课程状态

#### 4.1.5 选课记录表 (enrollments)
```sql
CREATE TABLE enrollments (
    id INT PRIMARY KEY AUTO_INCREMENT,
    student_id INT NOT NULL COMMENT '学生ID',
    course_id INT NOT NULL COMMENT '课程ID',
    semester VARCHAR(50) NOT NULL COMMENT '学期',
    academic_year VARCHAR(20) COMMENT '学年',
    enrollment_time TIMESTAMP DEFAULT CURRENT_TIMESTAMP COMMENT '选课时间',
    drop_time TIMESTAMP NULL COMMENT '退课时间',
    drop_reason VARCHAR(200) COMMENT '退课原因',
    status ENUM('enrolled', 'dropped', 'completed') DEFAULT 'enrolled',
    UNIQUE KEY uk_student_course_semester (student_id, course_id, semester),
    FOREIGN KEY (student_id) REFERENCES students(id) ON DELETE CASCADE,
    FOREIGN KEY (course_id) REFERENCES courses(id) ON DELETE CASCADE
) COMMENT='选课记录表';
```

**设计要点：**
- 支持同一课程在不同学期的重复选课
- 记录完整的选课和退课信息
- 通过唯一约束防止同一学期重复选课

#### 4.1.6 成绩表 (grades)
```sql
CREATE TABLE grades (
    id INT PRIMARY KEY AUTO_INCREMENT,
    enrollment_id INT NOT NULL COMMENT '选课记录ID',
    student_id INT NOT NULL COMMENT '学生ID',
    course_id INT NOT NULL COMMENT '课程ID',
    teacher_id INT NOT NULL COMMENT '任课教师ID',
    semester VARCHAR(50) NOT NULL COMMENT '学期',
    midterm_grade DECIMAL(5,2) COMMENT '期中成绩',
    final_grade DECIMAL(5,2) COMMENT '期末成绩',
    assignment_grade DECIMAL(5,2) COMMENT '作业成绩',
    attendance_grade DECIMAL(5,2) COMMENT '考勤成绩',
    total_grade DECIMAL(5,2) COMMENT '总成绩',
    grade_point DECIMAL(3,2) COMMENT '绩点',
    grade_level VARCHAR(10) COMMENT '等级(A+,A,B+,B,C+,C,D,F)',
    is_retake BOOLEAN DEFAULT FALSE COMMENT '是否重修',
    comments TEXT COMMENT '教师评语',
    graded_time TIMESTAMP NULL COMMENT '评分时间',
    UNIQUE KEY uk_enrollment (enrollment_id),
    FOREIGN KEY (enrollment_id) REFERENCES enrollments(id) ON DELETE CASCADE
) COMMENT='成绩表';
```

**设计要点：**
- 支持多维度成绩记录（期中、期末、作业、考勤）
- 自动计算总成绩、绩点和等级
- 支持重修标记和教师评语
- 通过enrollment_id确保成绩与选课记录一对一对应

### 4.2 扩展表结构

#### 4.2.1 课程时间表 (course_schedules)
```sql
CREATE TABLE course_schedules (
    id INT PRIMARY KEY AUTO_INCREMENT,
    course_id INT NOT NULL COMMENT '课程ID',
    day_of_week INT NOT NULL COMMENT '星期几(1-7, 1=周一)',
    start_time TIME NOT NULL COMMENT '开始时间',
    end_time TIME NOT NULL COMMENT '结束时间',
    classroom VARCHAR(100) COMMENT '教室',
    building VARCHAR(100) COMMENT '教学楼',
    weeks VARCHAR(100) COMMENT '授课周次（如：1-16周）',
    FOREIGN KEY (course_id) REFERENCES courses(id) ON DELETE CASCADE
) COMMENT='课程时间表';
```

#### 4.2.2 课程资源表 (course_resources)
```sql
CREATE TABLE course_resources (
    id INT PRIMARY KEY AUTO_INCREMENT,
    course_id INT NOT NULL COMMENT '课程ID',
    resource_name VARCHAR(200) NOT NULL COMMENT '资源名称',
    resource_type ENUM('document', 'video', 'audio', 'image', 'link', 'other') NOT NULL,
    file_path VARCHAR(500) COMMENT '文件路径',
    file_url VARCHAR(500) COMMENT '外部链接',
    file_size BIGINT COMMENT '文件大小(字节)',
    uploader_id INT NOT NULL COMMENT '上传者ID',
    description TEXT COMMENT '描述',
    is_public BOOLEAN DEFAULT TRUE COMMENT '是否公开',
    download_count INT DEFAULT 0 COMMENT '下载次数',
    FOREIGN KEY (course_id) REFERENCES courses(id) ON DELETE CASCADE,
    FOREIGN KEY (uploader_id) REFERENCES users(id) ON DELETE CASCADE
) COMMENT='课程资源表';
```

### 4.3 数据库关系图

```
users (基础用户表)
  ├── students (学生信息)
  ├── teachers (教师信息)
  └── admins (管理员信息)

courses (课程信息)
  ├── course_schedules (课程时间)
  ├── course_resources (课程资源)
  └── enrollments (选课记录)
      └── grades (成绩信息)

其他业务表：
├── books (图书管理)
├── products (商品管理)  
├── orders (订单管理)
└── forum_threads/posts (论坛系统)
```

## 5. Java类设计

### 5.1 基础类设计

#### 5.1.1 UserVO类 - 用户值对象类
```java
public class UserVO implements Serializable {
    // 基础字段
    private Integer userId;
    private String loginId;         // 登录ID（学号/工号/管理员ID）
    private String name;            // 姓名
    private String password;        // 密码
    private Integer role;           // 角色：0-学生，1-教师，2-管理员
    private Integer status;         // 状态：0-未激活，1-已激活
    private String phone;           // 联系电话
    private String email;           // 邮箱
    private String department;      // 所属院系
    private Double balance;         // 账户余额
    
    // 扩展字段（根据角色使用）
    private String gender;          // 性别（学生用）
    private String major;           // 专业（学生用）
    private String className;       // 班级（学生用）
    private String teacherNo;       // 工号（教师用）
    private String title;           // 职称（教师用）
    private String username;        // 用户名（管理员用）
    private String adminLevel;      // 管理员级别（管理员用）
    
    // 业务方法
    public boolean isStudent();
    public boolean isTeacher();
    public boolean isAdmin();
    public boolean isActivated();
    public String getFullIdentity();
}
```

**设计特点：**
- 统一的用户值对象，支持多角色
- 根据角色动态使用不同的扩展字段
- 保持与现有系统的兼容性
- 提供丰富的业务判断方法

#### 5.1.2 StudentVO类 - 学生值对象
```java
public class StudentVO implements Serializable {
    // 基础信息
    private Integer id;
    private String name;
    private String studentNo;
    private String gender;
    private Date birthDate;
    private String phone;
    private String email;
    private String address;
    private String department;
    private String className;
    private String major;
    private BigDecimal balance;
    
    // 关联对象
    private UserVO user;
    private List<CourseVO> enrolledCourses;
    private List<EnrollmentVO> enrollments;
    private List<GradeVO> grades;
    
    // 业务方法
    public BigDecimal getGPA();              // 计算GPA
    public int getTotalCredits();            // 获取总学分
    public boolean isEnrolledInCourse(Integer courseId);
}
```

#### 5.1.3 TeacherVO类 - 教师值对象
```java
public class TeacherVO implements Serializable {
    // 基础信息
    private Integer id;
    private String name;
    private String teacherNo;
    private String phone;
    private String email;
    private String department;
    private String title;
    private String office;
    private String researchArea;
    
    // 关联对象
    private UserVO user;
    private List<CourseVO> teachingCourses;
    private List<GradeVO> gradingRecords;
    
    // 业务方法
    public int getTeachingCourseCount();     // 教授课程数量
    public int getTotalStudents();           // 学生总数
    public boolean isTeachingCourse(Integer courseId);
}
```

### 5.2 核心业务类

#### 5.2.1 CourseVO类 - 课程值对象
```java
public class CourseVO implements Serializable {
    // 基础信息
    private Integer courseId;
    private String courseCode;
    private String courseName;
    private Integer credits;
    private String department;
    private String semester;
    private String academicYear;
    private String classTime;
    private String location;
    private Integer capacity;
    private Integer enrolledCount;
    private String status;                   // planning, active, inactive, completed
    private String description;
    private String prerequisites;
    private String syllabus;
    
    // 关联对象
    private TeacherVO teacher;
    private List<StudentVO> enrolledStudents;
    private List<CourseScheduleVO> schedules;
    private List<CourseResourceVO> resources;
    private List<EnrollmentVO> enrollments;
    
    // 业务方法
    public Integer getAvailableCapacity();   // 剩余容量
    public boolean isFull();                 // 是否已满
    public boolean isActive();               // 是否激活
    public String getFullCourseInfo();       // 完整课程信息
}
```

#### 5.2.2 EnrollmentVO类 - 选课记录值对象
```java
public class EnrollmentVO implements Serializable {
    // 基础信息
    private Integer enrollmentId;
    private Integer studentId;
    private Integer courseId;
    private String semester;
    private String academicYear;
    private Timestamp enrollmentTime;
    private Timestamp dropTime;
    private String dropReason;
    private String status;                   // enrolled, dropped, completed
    
    // 关联对象
    private StudentVO student;
    private CourseVO course;
    private GradeVO grade;
    
    // 业务方法
    public boolean isEnrolled();
    public boolean isDropped();
    public boolean isCompleted();
    public void dropCourse(String reason);   // 退课操作
    public String getFinalGrade();           // 最终成绩
    public String getStatusDescription();    // 状态描述
}
```

#### 5.2.3 GradeVO类 - 成绩值对象
```java
public class GradeVO implements Serializable {
    // 成绩信息
    private Integer id;
    private Integer enrollmentId;
    private Integer studentId;
    private Integer courseId;
    private Integer teacherId;
    private String semester;
    private BigDecimal midtermGrade;         // 期中成绩
    private BigDecimal finalGrade;           // 期末成绩
    private BigDecimal assignmentGrade;      // 作业成绩
    private BigDecimal attendanceGrade;      // 考勤成绩
    private BigDecimal totalGrade;           // 总成绩
    private BigDecimal gradePoint;           // 绩点
    private String gradeLevel;               // 等级
    private Boolean isRetake;                // 是否重修
    private String comments;                 // 教师评语
    
    // 业务方法
    public void calculateTotalGrade();       // 计算总成绩
    public boolean isPassed();               // 是否及格
    public boolean isExcellent();            // 是否优秀
    public String getFormattedGrade();       // 格式化成绩
}
```

### 5.3 辅助业务类

#### 5.3.1 CourseScheduleVO类 - 课程时间表
```java
public class CourseScheduleVO implements Serializable {
    private Integer id;
    private Integer courseId;
    private Integer dayOfWeek;               // 1-7 (周一到周日)
    private Time startTime;
    private Time endTime;
    private String classroom;
    private String building;
    private String weeks;                    // 授课周次
    
    // 业务方法
    public String getDayOfWeekName();        // 星期几中文名
    public String getTimeRange();            // 时间范围
    public String getLocation();             // 完整地点
    public boolean hasTimeConflict(CourseScheduleVO other); // 时间冲突检查
}
```

#### 5.3.2 CourseResourceVO类 - 课程资源
```java
public class CourseResourceVO implements Serializable {
    private Integer id;
    private Integer courseId;
    private String resourceName;
    private String resourceType;             // document, video, audio, image, link, other
    private String filePath;
    private String fileUrl;
    private Long fileSize;
    private Integer uploaderId;
    private String description;
    private Boolean isPublic;
    private Integer downloadCount;
    
    // 业务方法
    public String getFormattedFileSize();    // 格式化文件大小
    public boolean canAccess(String userRole); // 访问权限检查
    public String getAccessPath();           // 获取访问路径
}
```

#### 5.3.3 AdminVO类 - 管理员值对象
```java
public class AdminVO implements Serializable {
    private Integer id;
    private Integer userId;
    private String username;
    private String realName;
    private String adminLevel;               // super, normal
    private Map<String, Object> permissions;
    
    // 业务方法
    public boolean isSuperAdmin();
    public boolean hasPermission(String permission);
    public boolean canManageUsers();
    public boolean canManageCourses();
}
```

## 6. 业务流程设计

### 6.1 学生选课流程
1. **选课准备**：检查课程是否开放、容量是否充足、是否满足先修要求
2. **选课操作**：创建选课记录，更新课程已选人数
3. **成绩录入**：教师录入各项成绩，系统自动计算总成绩和绩点
4. **课程完成**：更新选课状态为已完成

### 6.2 教师授课流程
1. **课程创建**：创建课程基本信息，设置课程时间和地点
2. **资源管理**：上传课程资料，设置访问权限
3. **学生管理**：查看选课学生名单，管理选课申请
4. **成绩管理**：录入和更新学生成绩，添加评语

### 6.3 成绩计算流程
1. **分项录入**：期中成绩、期末成绩、作业成绩、考勤成绩
2. **权重计算**：根据预设权重计算总成绩
3. **绩点转换**：根据分数区间计算对应绩点
4. **等级评定**：根据分数确定等级（A+, A, B+, B, C+, C, D, F）

## 7. 技术特性

### 7.1 数据完整性
- **外键约束**：确保关联数据的一致性
- **唯一约束**：防止重复数据（如同学期重复选课）
- **级联删除**：自动维护关联数据的完整性
- **CHECK约束**：通过ENUM类型限制字段取值

### 7.2 性能优化
- **索引策略**：在常用查询字段创建索引
- **分页查询**：支持大数据量的分页显示
- **缓存机制**：常用数据的内存缓存
- **查询优化**：避免N+1查询问题

### 7.3 扩展性设计
- **模块化设计**：各业务模块相对独立
- **接口抽象**：便于功能扩展和替换
- **配置驱动**：通过配置文件管理系统参数
- **插件架构**：支持功能模块的热插拔

## 8. 安全考虑

### 8.1 数据安全
- **密码加密**：使用MD5或更强的加密算法
- **SQL注入防护**：使用参数化查询
- **权限控制**：基于角色的访问控制
- **数据验证**：输入数据的格式和范围验证

### 8.2 业务安全
- **选课限制**：防止超容量选课和重复选课
- **成绩保护**：只有授课教师可以录入成绩
- **操作日志**：记录关键操作的审计日志
- **会话管理**：安全的用户会话管理

## 9. 开发环境与部署

### 9.1 开发环境配置
- **JDK版本**: Java 8+
- **数据库**: MySQL 5.7+
- **开发工具**: IntelliJ IDEA 或 Eclipse
- **依赖库**: 
  - FlatLaf 3.4.1 (现代UI主题)
  - MySQL Connector 8.0.33
  - 其他第三方依赖位于 `libs/` 目录

### 9.2 数据库初始化
- **初始化脚本**: `resources/db/init.sql` - 创建所有表结构
- **测试数据**: `resources/db/data.sql` - 导入演示数据
- **配置文件**: `resources/config.properties` - 数据库连接配置

### 9.3 项目构建与运行
- **编译脚本**: `compile.bat` - 编译所有Java源码
- **启动服务器**: `start_server.bat` - 启动服务器端
- **启动客户端**: `start_client.bat` - 启动客户端应用
- **环境配置**: `setup_dev_env.bat` - 自动配置开发环境

## 10. 总结

vCampus虚拟校园系统是一个功能完整、架构清晰的校园管理平台，具有以下设计特点：

### 10.1 技术特点
1. **模块化架构**：各功能模块独立设计，便于维护和扩展
2. **数据完整性**：完善的外键约束和业务逻辑保证数据一致性
3. **角色分离**：支持学生、教师、管理员三种角色的差异化管理
4. **现代化界面**：采用FlatLaf主题，提供现代化的用户体验
5. **网络通信**：基于Socket的客户端-服务器架构，支持多用户并发

### 10.2 业务覆盖
1. **完整的教务管理**：从课程创建到成绩管理的全流程支持
2. **多样化服务**：集成图书管理、校园商城、论坛交流等功能
3. **灵活的权限控制**：基于角色的访问控制机制
4. **丰富的数据统计**：支持GPA计算、成绩分析等功能

### 10.3 扩展性
- 基于VO模式的数据传输，便于添加新字段和功能
- 分层架构设计，便于功能模块的独立升级
- 完善的数据库设计，支持业务需求的持续演进
- 标准化的开发规范，便于团队协作和维护

该系统为现代高校提供了一个集成化的数字校园解决方案，能够有效提升校园管理效率和用户体验。
